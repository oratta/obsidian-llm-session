# Product Requirements Document (PRD): Obsidian LLM Session

## 1. 製品概要
ObsidianのVault内で、プロジェクト（サブディレクトリ）ごとのコンテキストを理解したLLM（Claude Code等）と対話し、知的作業を支援するObsidianプラグイン。
ディレクトリ単位でセッションを管理し、そのディレクトリ内のファイル情報やルールに基づいた回答・提案を行う。

## 2. 目的・解決する課題
- **課題**: 汎用的なLLMチャットでは、ローカルのプロジェクト固有の文脈（ファイル構成、コーディング規約、ドキュメントの前提など）を共有するのが手間である。
- **目的**: ユーザーが作業中のディレクトリ（プロジェクト）を選択するだけで、その文脈を共有した状態のLLMセッションを即座に開始・再開できるようにする。

## 3. ターゲットユーザー
- Obsidianを用いて複数のプロジェクト（開発、執筆、研究など）を管理しているユーザー。
- ローカルファイルを参照しながらLLMと対話したいエンジニアやライター。

## 4. 機能要件

### 4.1. 基本機能 (Core)
- **ディレクトリ単位のセッション管理**:
    - ユーザーは対象のディレクトリ（プロジェクト）を選択してチャットを開始する。
    - ディレクトリごとに独立したLLMセッションが維持される。
    - 別のディレクトリに切り替えても、元のディレクトリのセッション履歴は保持される。
- **LLM連携**:
    - Claude Code (CLI) や Codex などの外部LLMサービスを利用する。
    - Claude Code CLIをラップして動作させる
- **コンテキスト認識**:
    - 選択されたディレクトリ内のファイルをコンテキストとしてLLMに提供する。
    - **自動サマライズ**: チャット開始前に `contexts` ディレクトリを作成し、ディレクトリ内の重要ファイルのサマリーを生成・格納する（トークン数節約のため）。
- **ルールファイルの適用**:
    - 初回起動時にルートにあるルールファイル（`.md`）を対象ディレクトリにコピーする。
    - 各セッションは、そのディレクトリ内のルールファイルに従って振る舞う。
    - ユーザーはObsidian上でルールファイルを編集可能なので、プロジェクト毎にルールを編集して異なる運用をすることが可能

### 4.2. UI/UX
- **チャットインターフェース**:
    - Obsidianのサイドパネル（または専用ビュー）で動作するチャットUI。
    - **ディレクトリ切り替え**: プルダウンメニュー等で作業対象のディレクトリを容易に切り替え可能。
    - **複数セッション表示**: 複数のビューを開いて、異なるディレクトリのセッションを並行して利用可能。
- **コンテキストメニュー連携**:
    - **ノートに対するチャット**: ノートを選択または開いた状態で「Obsidian LLM: Talk about this page」を実行すると、そのノートへのリンクが含まれた状態で、所属ディレクトリのセッションがアクティブになる。
    - **選択範囲に対するチャット**: テキストを選択して右クリックから起動。選択テキストとノートリンクが入力された状態でチャットを開始。

## 5. 技術的制約・前提
- Obsidian Desktop版（Mac/Windows/Linux）での動作を主とする。
- 外部LLMサービス（Claude Code等）の利用にはユーザー自身のAPIキーまたは認証が必要。

## 6. ロードマップ (MVPスコープ)
1. **フェーズ1 (MVP)**:
    - ディレクトリ選択とセッション確立。
    - テキストベースのチャットUI（コンソール風でも可）。
    - ルールファイルのコピーと適用。
    - 基本的なコンテキスト（ファイル一覧等）の読み込み。
2. **フェーズ2**:
    - コンテキストの自動サマライズ機能。
    - ノート/選択範囲からの右クリック起動連携。
    - UIのブラッシュアップ。

## 7. 未決定事項・検討事項
- **Claude Code CLIとの連携方法**: まずは単にターミナルのラッパーViewとして作ってみる。外側にディレクトリ選択などのUIをつける
